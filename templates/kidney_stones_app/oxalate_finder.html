{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Oxalate Content Finder - Kidney Stone Navigator{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="mb-0"><i class="bi bi-search me-2"></i>Oxalate Content Finder</h2>
                </div>
                <div class="card-body">
                    <p class="lead mb-4">Search for the oxalate content of various foods. Data is loaded from a local database.</p>
                    <form method="post" class="row g-3 mb-4">
                        {% csrf_token %}
                        <div class="col-md-8">
                            {{ form.search_term|as_crispy_field }}
                            <small class="form-text text-muted">You can search by food name or type (e.g., "Vegetable", "Fruit").</small>
                        </div>
                        <div class="col-md-4 text-end">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-search me-2"></i>Search
                            </button>
                        </div>
                    </form>
                    {% if results %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover align-middle oxalate-table">
                                <thead>
                                    <tr>
                                        <th><a href="?sort=food{% if request.GET.direction == 'asc' and request.GET.sort == 'food' %}&direction=desc{% else %}&direction=asc{% endif %}">Food</a></th>
                                        <th><a href="?sort=type{% if request.GET.direction == 'asc' and request.GET.sort == 'type' %}&direction=desc{% else %}&direction=asc{% endif %}">Type</a></th>
                                        <th><a href="?sort=oxalate_mg{% if request.GET.direction == 'asc' and request.GET.sort == 'oxalate_mg' %}&direction=desc{% else %}&direction=asc{% endif %}">Oxalate (mg)</a></th>
                                        <th><a href="?sort=serving_size{% if request.GET.direction == 'asc' and request.GET.sort == 'serving_size' %}&direction=desc{% else %}&direction=asc{% endif %}">Serving Size</a></th>
                                        <th><a href="?sort=oxalate_level{% if request.GET.direction == 'asc' and request.GET.sort == 'oxalate_level' %}&direction=desc{% else %}&direction=asc{% endif %}">Oxalate Level</a></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in results %}
                                    <tr>
                                        <td>{{ item.food }}</td>
                                        <td>{{ item.type }}</td>
                                        <td>{{ item.oxalate_mg }}</td>
                                        <td>{{ item.serving_size }}</td>
                                        <td>{{ item.oxalate_level }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            No results found. Try searching for a different food item or category.
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-link-45deg me-2"></i>External Resources</h5>
                </div>
                <div class="card-body">
                    <ul>
                        <li><a href="https://kidneystones.uchicago.edu/how-to-eat-a-low-oxalate-diet/" target="_blank">University of Chicago Kidney Stone Center: How to Eat a Low Oxalate Diet</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 